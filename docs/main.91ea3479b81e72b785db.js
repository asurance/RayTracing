!function(t){var e={};function o(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(r,i,function(e){return t[e]}.bind(null,i));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=2)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(5),i=function(){function t(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),this.x=t,this.y=e,this.z=o}return t.prototype.reset=function(){return this.x=this.y=this.z=0,this},t.prototype.set=function(t,e,o){return this.x=t,this.y=e,this.z=o,this},t.prototype.clone=function(e){return void 0===e&&(e=t.Pool.create()),e.x=this.x,e.y=this.y,e.z=this.z,e},t.prototype.length=function(){return Math.hypot(this.x,this.y,this.z)},t.prototype.sqauredLength=function(){return this.dot(this)},t.prototype.normalize=function(e){void 0===e&&(e=t.Pool.create());var o=this.length();return o>0&&this.multiScale(1/o,e),e},t.prototype.add=function(e,o){return void 0===o&&(o=t.Pool.create()),o.x=this.x+e.x,o.y=this.y+e.y,o.z=this.z+e.z,o},t.prototype.multiScale=function(e,o){return void 0===o&&(o=t.Pool.create()),o.x=this.x*e,o.y=this.y*e,o.z=this.z*e,o},t.prototype.multiVec3=function(e,o){return void 0===o&&(o=t.Pool.create()),o.x=this.x*e.x,o.y=this.y*e.y,o.z=this.z*e.z,o},t.prototype.reciprocal=function(e){return void 0===e&&(e=t.Pool.create()),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z,e},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.cross=function(e,o){void 0===o&&(o=t.Pool.create());var r=this.y*e.z-this.z*e.y,i=this.z*e.x-this.x*e.z,n=this.x*e.y-this.y*e.x;return o.x=r,o.y=i,o.z=n,o},t.prototype.reflect=function(e,o){return void 0===o&&(o=t.Pool.create()),o=this.add(e.multiScale(-2*this.dot(e),o),o)},t.prototype.toString=function(){return"("+this.x+","+this.y+","+this.z+")"},t.Pool=new r.RecyclablePool(t),t}();e.Vector3=i},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(0),i=function(){function t(t,e,o){void 0===o&&(o=0),this.depth=0,this.origin=t,this.direction=e,this.depth=o}return t.prototype.getPointAtT=function(t,e){var o=this;return void 0===e&&(e=r.Vector3.Pool.create()),r.Vector3.Pool.tidy((function(){return o.origin.add(o.direction.multiScale(t))}),e)},t}();e.Ray=i},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(3),i=o(4),n=o(7),c=o(0),u=o(8),s=o(9),a=o(10),l=o(11),d=document.createElement("canvas");d.width=r.global.WIDTH,d.height=r.global.HEIGHT,document.body.appendChild(d);var h=d.getContext("2d"),f=Math.cos(Math.PI/4),p=new u.World([new s.RTObject(new n.Sphere(c.Vector3.Pool.create().set(f,0,-1),f),new a.Normal),new s.RTObject(new n.Sphere(c.Vector3.Pool.create().set(-f,0,-1),f),new l.Reflect)]),y=new i.Camera(c.Vector3.Pool.create().set(0,0,0),c.Vector3.Pool.create().set(0,0,-1),c.Vector3.Pool.create().set(0,1,0),90,r.global.WIDTH,r.global.HEIGHT);y.render(p),h.putImageData(y.imageData,0,0)},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.global={WIDTH:201,HEIGHT:101}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(0),i=o(1),n=o(6);function c(t){t instanceof i.Ray?console.log("origin:"+t.origin+",direction:"+t.direction):console.log(t.toString())}var u=function(){function t(t,e,o,i,n,c){var u=this;this.origin=t,this.width=n,this.height=c,this.imageData=new ImageData(n,c);var s=i*Math.PI/180,a=Math.tan(s/2),l=n/c*a,d=r.Vector3.Pool.tidy((function(){return t.add(e.multiScale(-1)).normalize()})),h=r.Vector3.Pool.tidy((function(){return o.cross(d).normalize()})),f=d.cross(h);this.lowerLeftCorner=r.Vector3.Pool.tidy((function(){return u.origin.add(h.multiScale(l).add(f.multiScale(a)).add(d).multiScale(-1))})),this.horizontal=h.multiScale(2*l),this.vertical=f.multiScale(2*a)}return t.prototype.render=function(t){for(var e=this,o={t:0,position:r.Vector3.Pool.create(),normal:r.Vector3.Pool.create()},u=new i.Ray(this.origin,r.Vector3.Pool.create()),s=function(s){for(var l=function(l){var d=83===s&&49===l;r.Vector3.Pool.reUse(u.direction),u.direction=r.Vector3.Pool.tidy((function(){return e.lowerLeftCorner.add(e.horizontal.multiScale(s/(e.width-1)).add(e.vertical.multiScale(1-l/(e.height-1))))})),u.depth=0;var h=t.hitTest(u,o);for(d&&c(h);h instanceof i.Ray;){if(h.depth>10){h=r.Vector3.Pool.create().set(0,0,0);break}(h=t.hitTest(h,o))instanceof r.Vector3&&(0!==h.x||0!==h.y||0!==h.z)&&console.log(s+","+l),d&&c(h)}n.render2Image(a.imageData,s,l,h),r.Vector3.Pool.reUse(h)},d=0;d<a.height;d++)l(d)},a=this,l=0;l<this.width;l++)s(l);r.Vector3.Pool.reUse(u.direction)},t}();e.Camera=u},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){void 0===e&&(e=""),this.pool=[],this.tidyPool=[],this.isTidy=!1,this.count=0,this.logCount="",this.template=t,this.logCount=e}return t.prototype.create=function(){var t=this.pool.pop();return t?t.reset():(t=new this.template,this.logCount&&(this.count++,console.log(this.logCount+":"+this.count))),this.isTidy&&this.tidyPool.push(t),t},t.prototype.reUse=function(t){this.pool.push(t)},t.prototype.tidy=function(t,e){var o;void 0===e&&(e=this.create()),this.isTidy=!0;var r=t();return this.isTidy=!1,e=r.clone(e),(o=this.pool).push.apply(o,this.tidyPool),this.tidyPool.length=0,e},t}();e.RecyclablePool=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.render2Image=function(t,e,o,r){var i=o*t.width+e<<2;t.data[i]=Math.floor(255.99*r.x),t.data[i+1]=Math.floor(255.99*r.y),t.data[i+2]=Math.floor(255.99*r.z),t.data[i+3]=255}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(0),i=function(){function t(t,e){this.center=t.clone(),this.radius=e}return t.prototype.hitTest=function(t,e,o,i){var n=this,c=r.Vector3.Pool.tidy((function(){return t.origin.add(n.center.multiScale(-1))})),u=t.direction.sqauredLength(),s=c.dot(t.direction),a=c.sqauredLength()-this.radius*this.radius;if(r.Vector3.Pool.reUse(c),s*s-u*a){var l=Math.sqrt(s*s-u*a),d=(-s-l)/u;if(d<o&&d>e)return i.t=d,i.position=t.getPointAtT(d,i.position),i.normal=r.Vector3.Pool.tidy((function(){return i.position.add(n.center.multiScale(-1)).multiScale(1/n.radius)}),i.normal),!0;if((d=(-s+l)/u)<o&&d>e)return i.t=d,i.position=t.getPointAtT(d,i.position),i.normal=r.Vector3.Pool.tidy((function(){return i.position.add(n.center.multiScale(-1)).multiScale(1/n.radius)}),i.normal),!0}return!1},t}();e.Sphere=i},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(0),i=function(){function t(t){this.objs=t}return t.prototype.hitTest=function(t,e){var o=null,i=1/0;return this.objs.forEach((function(r,n){r.shape.hitTest(t,1e-10,i,e)&&(o=n,i=e.t)})),null!==o?this.objs[o].mat.scatter(t,e):r.Vector3.Pool.create().set(0,0,0)},t}();e.World=i},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e){this.shape=t,this.mat=e};e.RTObject=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.scatter=function(t,e){return e.normal.clone()},t}();e.Normal=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(1),i=o(0),n=function(){function t(){}return t.prototype.scatter=function(t,e){return t.direction.dot(e.normal)>=0?i.Vector3.Pool.create().set(0,0,0):new r.Ray(e.position.clone(),i.Vector3.Pool.tidy((function(){return t.direction.normalize().reflect(e.normal)})),t.depth+1)},t}();e.Reflect=n}]);